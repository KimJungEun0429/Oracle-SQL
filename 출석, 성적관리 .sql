CREATE TABLE REGIONS
(
    RGID        CHAR(4)         NOT NULL PRIMARY KEY,
    RNAME       VARCHAR2(30)    NOT NULL
);

INSERT INTO REGIONS VALUES('RG01', '부산');
INSERT INTO REGIONS VALUES('RG02', '울산');
INSERT INTO REGIONS VALUES('RG03', '창원');
INSERT INTO REGIONS VALUES('RG04', '김해');
INSERT INTO REGIONS VALUES('RG05', '대구');
INSERT INTO REGIONS VALUES('RG06', '안동');

INSERT INTO REGIONS VALUES('RG07', '경산');
INSERT INTO REGIONS VALUES((
    SELECT 
        'RG' || TRIM(TO_CHAR(TO_NUMBER(SUBSTR(MAX(RGID),3,2)) + 1 , '00'))
    FROM REGIONS
), '분당');
--값으로 들어갈땐 괄호를 꼭 해주고 넣는다.
----------------------------------------------
--자동으로 ID를 만드는 방법.
--1.MAX값을 찾는다
--2.숫자 뒤 두자리를 잘라낸다
--3.문자를 숫자로 바꾼다(1를  더해주기위해)
--4.TO_CHAR를 통해 내가 만들고자하는 형식을 준다
--5.오라클 버그 때문에 맨앞에 공백이 자동으로 생기니까 공백을 제거해준다
SELECT 
    'RG' || TRIM(TO_CHAR(TO_NUMBER(SUBSTR(MAX(RGID),3,2)) + 1 , '00'))
FROM REGIONS;
---------------------------------------------많이 쓰는 코딩~~

SELECT * FROM REGIONS;

CREATE TABLE STUDENTS
(
    SID     CHAR(4)         NOT NULL  PRIMARY KEY,
    SNAME   VARCHAR2(30)    NOT NULL,
    STEL    VARCHAR2(20)    NOT NULL,
    SADDR   VARCHAR2(10)    NOT NULL,
    SGENDER CHAR(1)         NOT NULL, 
    SAGE     NUMBER(3)       NOT NULL
);

    INSERT INTO STUDENTS VALUES('S001', '김돌우', '01077778888', 'RG01', 'M', 24);
    INSERT INTO STUDENTS VALUES('S002', '박영익', '01055556666', 'RG01', 'M', 27);
    INSERT INTO STUDENTS VALUES('S003', '도소욱', '01088887777', 'RG02', 'M', 28);
    INSERT INTO STUDENTS VALUES('S004', '정미주', '01055554444', 'RG02', 'F', 22);
    INSERT INTO STUDENTS VALUES('S005', '김기윤', '01077775555', 'RG03', 'M', 21);
    INSERT INTO STUDENTS VALUES('S006', '이효진', '01066669999', 'RG03', 'F', 25);
    INSERT INTO STUDENTS VALUES('S007', '강신욱', '01044447777', 'RG01', 'M', 23);
    INSERT INTO STUDENTS VALUES('S008', '박범식', '01099998888', 'RG02', 'M', 27);
    INSERT INTO STUDENTS VALUES('S009', '여인순', '01051477787', 'RG01', 'F', 31);
    INSERT INTO STUDENTS VALUES('S010', '최순애', '01078974444', 'RG04', 'F', 32);
    
     INSERT INTO STUDENTS VALUES('S011', '박구라', '0107893334', 'RG07', 'F', 26);
    
    --COMMIT;
    
CREATE TABLE ATTENDANCE
(
    AIDX    NUMBER(5)       NOT NULL    PRIMARY KEY,
    SID     CHAR(4)         NOT NULL,
    SUBID   CHAR(4)         NOT NULL,
    ADATE   DATE            NOT NULL
);

    INSERT INTO ATTENDANCE VALUES(1, 'S001', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(2, 'S001', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(3, 'S001', 'SUB3', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(4, 'S001', 'SUB4', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(5, 'S001', 'SUB5', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(6, 'S001', 'SUB6', '2021-04-05');
        
    
    INSERT INTO ATTENDANCE VALUES(7, 'S002', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(8, 'S002', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(9, 'S002', 'SUB3', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(10, 'S002', 'SUB4', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(11, 'S002', 'SUB5', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(12, 'S002', 'SUB6', '2021-04-05');
    
    INSERT INTO ATTENDANCE VALUES(13, 'S003', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(14, 'S003', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(15, 'S003', 'SUB3', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(16, 'S003', 'SUB4', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(17, 'S003', 'SUB5', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(18, 'S003', 'SUB6', '2021-04-05');
    
    INSERT INTO ATTENDANCE VALUES(19, 'S004', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(20, 'S004', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(21, 'S004', 'SUB3', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(22, 'S004', 'SUB4', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(23, 'S004', 'SUB5', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(24, 'S004', 'SUB6', '2021-04-05');
    
    INSERT INTO ATTENDANCE VALUES(25, 'S005', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(26, 'S005', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(27, 'S005', 'SUB3', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(28, 'S005', 'SUB4', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(29, 'S005', 'SUB5', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(30, 'S005', 'SUB6', '2021-04-05');
    
    INSERT INTO ATTENDANCE VALUES(31, 'S006', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(32, 'S006', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(33, 'S006', 'SUB3', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(34, 'S006', 'SUB4', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(35, 'S006', 'SUB5', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(36, 'S006', 'SUB6', '2021-04-05');
    
    INSERT INTO ATTENDANCE VALUES(37, 'S007', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(38, 'S007', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(39, 'S007', 'SUB3', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(40, 'S007', 'SUB4', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(41, 'S007', 'SUB5', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(42, 'S007', 'SUB6', '2021-04-05');
    
    INSERT INTO ATTENDANCE VALUES(43, 'S008', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(44, 'S008', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(45, 'S008', 'SUB5', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(46, 'S008', 'SUB6', '2021-04-05');
    
    INSERT INTO ATTENDANCE VALUES(47, 'S009', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(48, 'S009', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(49, 'S009', 'SUB3', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(50, 'S009', 'SUB4', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(51, 'S009', 'SUB5', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(52, 'S009', 'SUB6', '2021-04-05');
    
    INSERT INTO ATTENDANCE VALUES(53, 'S010', 'SUB1', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(54, 'S010', 'SUB2', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(55, 'S010', 'SUB4', '2021-04-05');
    INSERT INTO ATTENDANCE VALUES(56, 'S010', 'SUB5', '2021-04-05');

    INSERT INTO ATTENDANCE VALUES(101, 'S001', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(102, 'S001', 'SUB2', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(103, 'S001', 'SUB3', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(104, 'S001', 'SUB4', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(105, 'S001', 'SUB5', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(106, 'S001', 'SUB6', '2021-04-06');
    
    INSERT INTO ATTENDANCE VALUES(107, 'S002', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(108, 'S002', 'SUB2', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(109, 'S002', 'SUB3', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(110, 'S002', 'SUB5', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(111, 'S002', 'SUB6', '2021-04-06');
    
    INSERT INTO ATTENDANCE VALUES(112, 'S003', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(113, 'S003', 'SUB2', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(114, 'S003', 'SUB3', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(115, 'S003', 'SUB4', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(116, 'S003', 'SUB5', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(117, 'S003', 'SUB6', '2021-04-06');
    
    INSERT INTO ATTENDANCE VALUES(118, 'S004', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(119, 'S004', 'SUB4', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(120, 'S004', 'SUB5', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(121, 'S004', 'SUB6', '2021-04-06');
    
    INSERT INTO ATTENDANCE VALUES(122, 'S005', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(123, 'S005', 'SUB2', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(124, 'S005', 'SUB3', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(125, 'S005', 'SUB4', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(126, 'S005', 'SUB5', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(127, 'S005', 'SUB6', '2021-04-06');
    
    INSERT INTO ATTENDANCE VALUES(128, 'S006', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(129, 'S006', 'SUB2', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(130, 'S006', 'SUB3', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(131, 'S006', 'SUB4', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(132, 'S006', 'SUB5', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(133, 'S006', 'SUB6', '2021-04-06');
    
    INSERT INTO ATTENDANCE VALUES(134, 'S007', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(135, 'S007', 'SUB2', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(136, 'S007', 'SUB3', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(137, 'S007', 'SUB4', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(138, 'S007', 'SUB5', '2021-04-06');
    
    INSERT INTO ATTENDANCE VALUES(139, 'S008', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(140, 'S008', 'SUB2', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(141, 'S008', 'SUB3', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(142, 'S008', 'SUB4', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(143, 'S008', 'SUB5', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(144, 'S008', 'SUB6', '2021-04-06');
    
    INSERT INTO ATTENDANCE VALUES(145, 'S009', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(146, 'S009', 'SUB2', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(147, 'S009', 'SUB3', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(148, 'S009', 'SUB4', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(149, 'S009', 'SUB5', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(150, 'S009', 'SUB6', '2021-04-06');
    
    INSERT INTO ATTENDANCE VALUES(151, 'S010', 'SUB1', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(152, 'S010', 'SUB3', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(153, 'S010', 'SUB4', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(154, 'S010', 'SUB5', '2021-04-06');
    INSERT INTO ATTENDANCE VALUES(155, 'S010', 'SUB6', '2021-04-06');
    
    
    
    INSERT INTO ATTENDANCE VALUES(201, 'S001', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(202, 'S001', 'SUB2', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(203, 'S001', 'SUB3', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(204, 'S001', 'SUB4', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(205, 'S001', 'SUB5', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(206, 'S001', 'SUB6', '2021-04-07');
    
    INSERT INTO ATTENDANCE VALUES(207, 'S002', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(208, 'S002', 'SUB2', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(209, 'S002', 'SUB3', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(210, 'S002', 'SUB4', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(211, 'S002', 'SUB5', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(212, 'S002', 'SUB6', '2021-04-07');
    
    INSERT INTO ATTENDANCE VALUES(213, 'S003', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(214, 'S003', 'SUB2', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(215, 'S003', 'SUB3', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(216, 'S003', 'SUB6', '2021-04-07');
    
    INSERT INTO ATTENDANCE VALUES(217, 'S004', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(218, 'S004', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(219, 'S004', 'SUB4', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(220, 'S004', 'SUB5', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(221, 'S004', 'SUB6', '2021-04-07');
    
    INSERT INTO ATTENDANCE VALUES(222, 'S005', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(223, 'S005', 'SUB2', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(224, 'S005', 'SUB3', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(225, 'S005', 'SUB4', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(226, 'S005', 'SUB5', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(227, 'S005', 'SUB6', '2021-04-07');
    
    INSERT INTO ATTENDANCE VALUES(228, 'S006', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(229, 'S006', 'SUB2', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(230, 'S006', 'SUB3', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(231, 'S006', 'SUB4', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(232, 'S006', 'SUB5', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(233, 'S006', 'SUB6', '2021-04-07');
    
    INSERT INTO ATTENDANCE VALUES(234, 'S007', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(235, 'S007', 'SUB2', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(236, 'S007', 'SUB3', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(237, 'S007', 'SUB5', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(238, 'S007', 'SUB6', '2021-04-07');
    
    INSERT INTO ATTENDANCE VALUES(239, 'S008', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(240, 'S008', 'SUB2', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(241, 'S008', 'SUB3', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(242, 'S008', 'SUB4', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(243, 'S008', 'SUB5', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(244, 'S008', 'SUB6', '2021-04-07');
    
    INSERT INTO ATTENDANCE VALUES(245, 'S009', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(246, 'S009', 'SUB2', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(247, 'S009', 'SUB3', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(248, 'S009', 'SUB4', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(249, 'S009', 'SUB5', '2021-04-07');
    
    INSERT INTO ATTENDANCE VALUES(250, 'S010', 'SUB1', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(251, 'S010', 'SUB3', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(252, 'S010', 'SUB4', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(253, 'S010', 'SUB5', '2021-04-07');
    INSERT INTO ATTENDANCE VALUES(254, 'S010', 'SUB6', '2021-04-07');
    
    --1.출석 리스트(학생 이름, 과목명, 날짜)
    SELECT T1.SNAME, T2.SNAME, TO_CHAR(T3.ADATE,'YYYYMMDD')
    FROM STUDENTS T1, SUBJECTS T2, ATTENDANCE T3
    WHERE T1.SID = T3.SID
    AND T2.SUBID = T3.SUBID
    ;
    --프라이머리키가 아닌 것에 조인을 걸면 안된다.
    --조인을 했을 때 나오는 데이터 수와 행위테이블의 데이터(ROW갯)수와 일치해야한다.
    --현장에서 숫자가 다르면 상사한테가서 1:多가 아니라서 조인을 걸 수 없다고 물어봐야함
    
    --2. 학생별로 출석한 횟수를 보여주세요
    SELECT T1.SID, T1.SNAME, COUNT(T2.SID) AS CNT
    FROM STUDENTS T1, ATTENDANCE T2
    WHERE T1.SID = T2.SID
    GROUP BY T1.SID, T1.SNAME
    ORDER BY T1.SID
    ;
    --이렇게되면 틀린 코딩이다. 학생에 한명이 더 추가되면 출석을 안한 학생은 아예 뜨지 않기 때문에.
    SELECT T1.SID, T1.SNAME, COUNT(T2.SID) AS CNT
    FROM STUDENTS T1, ATTENDANCE T2
    WHERE T1.SID = T2.SID(+)
    GROUP BY T1.SID, T1.SNAME
    ORDER BY T1.SID
    ;
    --박구라 학생을 추가했을 때 출석이 없다고 떠야하므로 아우터 조인을 걸고 
    --COUNT를 널값이 들어있을 부분으로 넣어주기
    
    --3. 남학생, 여학생 각각의 평균 나이를 구해주세요
   
    SELECT DECODE(SGENDER,'M','남학생','F','여학생','메롱') AS GENDER, AVG(SAGE) 
    FROM STUDENTS 
    GROUP BY SGENDER
    ;
    --DECODE의 메롱자리는 둘다 아니면 이걸 줘라!
    
    --4. '3일동안 전과목을 출석'(일단은 18개다)한 학생 리스트를 학생이름, 성별, 나이 보여주세요
    
    
    
    SELECT * FROM SUBJECTS;
    SELECT * FROM STUDENTS;
    SELECT * FROM ATTENDANCE;
    
    --4-1. 18이라는 숫자를 어떻게 찾을지 생각
    SELECT ADATE
    FROM ATTENDANCE
    GROUP BY ADATE
    ;
    --조심해야할 점. 4월8일에 학생이 단 한명도 안나왔을 경우를 생각해야함. 데이터가 없으니까
    --4-2. 크로스 조인을 걸면 전체 출석이 나옴.
    SELECT COUNT(*) FROM
    (
    SELECT ADATE
    FROM ATTENDANCE
    GROUP BY ADATE
    )T1, SUBJECTS T2
    ;
    --4-3. 학생별로 출석한 데이터가 필요
   SELECT * FROM
   (
    SELECT T1.SID, T1.SNAME, COUNT(T2.SID) AS CNT
    FROM STUDENTS T1, ATTENDANCE T2
    WHERE T1.SID = T2.SID(+)
    GROUP BY T1.SID, T1.SNAME
   )
   WHERE CNT =
   (
        SELECT COUNT(*) FROM
        (
        SELECT ADATE
        FROM ATTENDANCE
        GROUP BY ADATE
        )T1, SUBJECTS T2
   )
    ;
    ----------------------------------------------------------

  
    SELECT T1.SNAME, T1.SGENDER, T1.SAGE, T2.SUBID, T3.SNAME, T2.ADATE
    FROM STUDENTS T1, ATTENDANCE T2, SUBJECTS T3
    WHERE T1.SID = T2.SID --출석한 학생 데이터
    AND T3.SUBID = T2.SUBID --수업이 있는 과목에 출석한 학생 데이터
    AND(TO_CHAR(T2.ADATE,'YYYYMMDD') = '20210405' OR TO_CHAR(T2.ADATE,'YYYYMMDD') = '20210406' OR TO_CHAR(T2.ADATE,'YYYYMMDD') = '20210407')
    ORDER BY T2.ADATE
    ;
    ----------------------AND, OR 질문 : DATE타입으로 T2에 들어가있기 때문에 TO_CHAR로 타입을 변경해주고 OR이 들어있는 ROW를 먼저 읽어야해서 ()로 감싸준다.
    ----------------------()로 안감싸주면 AND뒤에 붙은 조건을 먼저 읽고 다음 OR을 읽어서 말이안됨
    
    --5.4월한달간 4월1일부터 4월30일까지 날짜별로 출석한 학생수를 찾자
    
    SELECT A.ADATE, COUNT(B.ADATE) 
    FROM 
    (
    SELECT TO_DATE('2021-04-01') + (LEVEL-1) AS ADATE
    FROM DUAL
    CONNECT BY LEVEL <= 30
    )A,
    (
    SELECT T2.ADATE
    FROM STUDENTS T1, ATTENDANCE T2
    WHERE T1.SID = T2.SID(+)
    )B
    WHERE TO_CHAR(A.ADATE,'YY/MM/DD') = TO_CHAR(B.ADATE(+),'YY/MM/DD')
    GROUP BY A.ADATE
    ORDER BY A.ADATE
    ;
    
    SELECT T1.SNAME, T2.ADATE, COUNT(*)
    FROM STUDENTS T1, ATTENDANCE T2
    WHERE T1.SID = T2.SID(+)
    GROUP BY T1.SNAME, T2.ADATE
    ORDER BY T1.SNAME
    ;--출석한 학생 데이터
    
    SELECT TO_DATE('2021-04-01') + (LEVEL-1) AS ADATE
    FROM DUAL
    CONNECT BY LEVEL <= 30
    ;--4월30일까지 날짜 만들어주는 것
    
     --5.4월한달간 4월1일부터 4월30일까지 날짜별로 출석한 학생수를 찾자(NVL사용버전)
    SELECT B.BDATE,NVL(A.CNT,0)
    FROM
    (
        SELECT TO_CHAR(ADATE, 'YYYY-MM-DD') AS ADATE, COUNT(*) AS CNT
        FROM ATTENDANCE
        GROUP BY ADATE
    )A,
    (
        SELECT TO_CHAR(TO_DATE('2021-04-01') + (LEVEL-1),'YYYY-MM-DD') AS BDATE
        FROM DUAL
        CONNECT BY LEVEL <= 30
    )B
    WHERE B.BDATE = A.ADATE(+)
    ORDER BY B.BDATE
    ;
    
   
    
    --6.4월한달간 4월1일부터 4월30일까지 날짜별로 출석한 학생수를 찾자(토,일 제외)/7이 토욜 1이 일욜
    SELECT A.ADATE, COUNT(B.ADATE) 
    FROM 
    (
     SELECT TO_DATE('2021-04-01') + (LEVEL-1) AS ADATE, TO_CHAR(TO_DATE('2021-04-01') + (LEVEL-1),'D') AS DD
    FROM DUAL
    WHERE TO_CHAR(TO_DATE('2021-04-01') + (LEVEL-1),'D') != 1 AND TO_CHAR(TO_DATE('2021-04-01') + (LEVEL-1),'D') != 7
    CONNECT BY LEVEL <= 30
    )A,
    (
    SELECT T2.ADATE
    FROM STUDENTS T1, ATTENDANCE T2
    WHERE T1.SID = T2.SID(+)
    )B
    WHERE TO_CHAR(A.ADATE,'YY/MM/DD') = TO_CHAR(B.ADATE(+),'YY/MM/DD')
    GROUP BY A.ADATE
    ORDER BY A.ADATE
    ;
    
    SELECT TO_DATE('2021-04-01') + (LEVEL-1) AS ADATE, TO_CHAR(TO_DATE('2021-04-01') + (LEVEL-1),'D') AS DD
    FROM DUAL
    WHERE TO_CHAR(TO_DATE('2021-04-01') + (LEVEL-1),'D') != 1 AND TO_CHAR(TO_DATE('2021-04-01') + (LEVEL-1),'D') != 7
    CONNECT BY LEVEL <= 30
    ;
    
    --7.지역별 학생수
    SELECT T2.RNAME, COUNT(SID)
    FROM STUDENTS T1, REGIONS T2
    WHERE T1.SADDR = T2.RGID
    GROUP BY T2.RNAME
    ;
    
    --8.지역이 부산,울산인 학생리스트
    SELECT T1.SNAME, T2.RNAME
    FROM STUDENTS T1, REGIONS T2
    WHERE T1.SADDR = T2.RGID
    AND (T2.RNAME = '부산' OR T2.RNAME = '울산')
    ;
    
    --9.지역별 학생들의 출석률 -- 매우 어렵네,,,, 0413기준 나는 풀 수 없다
    SELECT T3.RGID, T3.RNAME, COUNT(T2.SID)
    FROM STUDENTS T1, ATTENDANCE T2, REGIONS T3
    WHERE T1.SID = T2.SID(+)
    AND T1.SADDR = T3.RGID
    GROUP BY T3.RGID, T3.RNAME
    ;--지역별 해당과목 수업의 출석 총 횟수
    
    SELECT T3.RGID, T3.RNAME, COUNT(*)
    FROM STUDENTS T1, ATTENDANCE T2, REGIONS T3
    WHERE T1.SID = T2.SID
    AND T1.SADDR = T3.RGID
    GROUP BY T3.RGID, T3.RNAME
    ;
     
    SELECT *
    FROM
    (
        SELECT T3.RGID, T3.RNAME, COUNT(T2.SID)
        FROM STUDENTS T1, ATTENDANCE T2, REGIONS T3
        WHERE T1.SID = T2.SID(+)
        AND T1.SADDR = T3.RGID
        GROUP BY T3.RGID, T3.RNAME
        ;
    )A,
    (
        SELECT T1.SADDR, COUNT(*) * (SELECT COUNT(ADATE) FROM ATTENDANCE ;)
        FROM STUDENTS T1, SUBJECTS T2
        GROUP BY T1.SADDR
        ORDER BY T1.SADDR
        ;--하루치....밖에 안된다.
    )B 
    ;
    
        SELECT * 
        FROM
        (
            SELECT *
            FROM STUDENTS T1, ATTENDANCE T2
            WHERE T1.SID = T2.SID(+)
            ;
        )A,
        (
            SELECT TO_DATE('2021-04-01') + (LEVEL-1) AS BDATE
            FROM DUAL
            CONNECT BY LEVEL <= 30
        )B
        WHERE A.ADATE = B.BDATE
        ;
        
    
    
  
    
    --지역별 전체 출석수 
        SELECT T1.SADDR, COUNT(*)
        FROM STUDENTS T1, SUBJECTS T2
        GROUP BY T1.SADDR
        ORDER BY T1.SADDR
        ;
    
    
    DELETE FROM ATTENDANCE
    WHERE AIDX = 218;
    
    --COMMIT;
    
 
 
    
    
    
CREATE TABLE PROFESSORS
(
    PID     CHAR(4)         NOT NULL  PRIMARY KEY,
    PNAME   VARCHAR2(30)    NOT NULL,
    PTEL    VARCHAR2(20)    NOT NULL,
    PADDR   VARCHAR2(10)    NOT NULL,
    PGENDER CHAR(1)         NOT NULL,
    BIRTH   VARCHAR2(8)     NOT NULL
);
    
    INSERT INTO PROFESSORS VALUES('P001','최국일','01099996566','RG03','M','19730804');
    INSERT INTO PROFESSORS VALUES('P002','경승수','01077148888','RG01','M','19710109');
    INSERT INTO PROFESSORS VALUES('P003','박수연','01055414444','RG01','F','19780214');
    INSERT INTO PROFESSORS VALUES('P004','김경순','01024147784','RG01','F','19801222');
    INSERT INTO PROFESSORS VALUES('P005','박수걸','01074145887','RG02','M','19770505');
    INSERT INTO PROFESSORS VALUES('P006','도인중','01021444444','RG04','M','19781128');
    INSERT INTO PROFESSORS VALUES('P007','이수영','01057414414','RG02','F','19800107');
    INSERT INTO PROFESSORS VALUES('P008','이국중','01092417984','RG03','M','19730309');
    INSERT INTO PROFESSORS VALUES('P009','박도우','01092417984','RG05','M','19801009');
    INSERT INTO PROFESSORS VALUES('P010','이연수','01092417984','RG01','F','19820509');
    
    --COMMIT
    
CREATE TABLE SUBJECTS
(
    SUBID     CHAR(4)         NOT NULL PRIMARY KEY,
    SNAME   VARCHAR2(30)    NOT NULL,
    GRADE   NUMBER(3)       NOT NULL               --학점
);

    INSERT INTO SUBJECTS VALUES('SUB1','국어',3);
    INSERT INTO SUBJECTS VALUES('SUB2','수학',3);
    INSERT INTO SUBJECTS VALUES('SUB3','영어',3);
    INSERT INTO SUBJECTS VALUES('SUB4','과학',2);
    INSERT INTO SUBJECTS VALUES('SUB5','사회',2);
    INSERT INTO SUBJECTS VALUES('SUB6','음악',1);
    --COMMIT;
    
    --1. 학생리스트를 보여주세요. SADDR자리에 지역이름으로
     SELECT *
    FROM STUDENTS T1, REGIONS T2
    WHERE T1.SADDR = T2.RGID
    ;
    
    --2. 현재 등록된 지역중에 학생이 한명도 살고 있지 않은 지역
    SELECT *--T2.RNAME
    FROM STUDENTS T1, REGIONS T2
    WHERE T1.SADDR(+) = T2.RGID
    --AND T1.SID IS NULL
    ;
    
    --3.지역별로 살고있는 학생 수를 구하시오. 살고 있지 않다면 0으로 표시
    SELECT  T2.RNAME, COUNT(T1.SADDR) AS CNT
    FROM STUDENTS T1, REGIONS T2
    WHERE T1.SADDR(+) = T2.RGID
    GROUP BY T2.RNAME
    ;
    
    SELECT  T2.RNAME, COUNT(T1.SID) AS CNT
    FROM STUDENTS T1, REGIONS T2
    WHERE T1.SADDR(+) = T2.RGID
    GROUP BY T2.RNAME
    ;
    --NULL이 들어있는 ROW는 안센다는 것을 아는 것이 중요하다(NULL이 들어있는 필드 중 하나를 COUNT에 넣어주면 됨)
    
    
CREATE TABLE EXAMS
(
    PID        CHAR(4)          NOT NULL,
    SUBID      CHAR(4)          NOT NULL,
    EIDX       NUMBER(5)        NOT NULL,
    ENAME      VARCHAR2(30)     NOT NULL
);

    INSERT INTO EXAMS VALUES('P001','SUB1',1,'국어 시험');
    INSERT INTO EXAMS VALUES('P002','SUB2',1,'수학 시험');
    INSERT INTO EXAMS VALUES('P003','SUB3',1,'영어 시험');
    INSERT INTO EXAMS VALUES('P004','SUB4',1,'과학 시험');
    INSERT INTO EXAMS VALUES('P005','SUB5',1,'사회 시험');
    INSERT INTO EXAMS VALUES('P006','SUB6',1,'음악 시험');
    
    --COMMIT;
    
    SELECT * FROM EXAMS;
    
    --1.교수중에 시험문제를 출제하지 않은 교수 찾기
    SELECT *
    FROM PROFESSORS T1, EXAMS T2
    WHERE T1.PID = T2.PID(+)
    AND T2.PID IS NULL
    ;
    
    --2.교수중에 나이가 제일 많은 교수를 찾자
    SELECT  * FROM
    (
    SELECT  PID,PNAME, BIRTH, TO_NUMBER(TO_CHAR(TO_DATE(SYSDATE),'YYYY')) - TO_NUMBER(TO_CHAR(TO_DATE(BIRTH),'YYYY')) AS P_AGE
    ,RANK() OVER(ORDER BY TO_CHAR(TO_DATE(SYSDATE),'YYYY') - TO_CHAR(TO_DATE(BIRTH),'YYYY')) AS RNK
    FROM PROFESSORS
    )
    WHERE RNK = 1
    ;
    
    SELECT PID, PNAME,
        RANK() OVER(ORDER BY BIRTH ASC) AS BIRTHRNK
    FROM PROFESSORS
    ;
    
    --3.교수리스트 보여주는데 교수아이디, 교수명, 교수연락처, 교수성별(남,여), 교수나이
    
    SELECT PID, PNAME, PTEL, DECODE(PGENDER,'M','남','F','여') AS GENDER
    ,TO_NUMBER(TO_CHAR(TO_DATE(SYSDATE),'YYYY')) - TO_NUMBER(TO_CHAR(TO_DATE(BIRTH),'YYYY')) AS P_AGE
    FROM PROFESSORS
    ;
    --오라클에서 문자열 - 문자열해도 빠지긴하는데 좀 더 안전하게 하려면 TO_NUMBER로 바꿔놓고 해주는게 좋음
    
    --4. 지역별 교수 숫자(지역이름, 교수숫자)
    SELECT T2.RNAME, COUNT(T1.PID)
    FROM PROFESSORS T1, REGIONS T2
    WHERE T1.PADDR(+) = T2.RGID
    GROUP BY T2.RNAME
    ORDER BY T2.RNAME
    ;
    
    --5.70년대생, 80년대생 교수 숫자 찾기
    SELECT SUBSTR(BIRTH,1,3) || 0 || '년생'  AS BIR, COUNT(BIRTH)
    FROM PROFESSORS
    GROUP BY SUBSTR(BIRTH,1,3) || 0
    ;

    --6.나이가 제일 많은 교수가 출제한 시험과목
   SELECT * FROM
   (
    SELECT A.PNAME, A.P_AGE, B.ENAME
    ,RANK() OVER(ORDER BY P_AGE DESC) AS RNK
    FROM
    (
    SELECT  PID,PNAME, BIRTH, TO_NUMBER(TO_CHAR(TO_DATE(SYSDATE),'YYYY')) - TO_NUMBER(TO_CHAR(TO_DATE(BIRTH),'YYYY')) AS P_AGE
    FROM PROFESSORS
    )A, EXAMS B
    WHERE A.PID = B.PID
    )
    WHERE RNK = 1
    ;
    
    SELECT T1.PID, T1.PNAME, T2.ENAME, T1,BIRTH,
    RANK() OVER(ORDER BY T1.BIRTH );
    ----------------------다시 보기
    --부산에 사는 여자교수중에 나이가 40이상인 교수
    
    SELECT PNAME, TO_NUMBER(TO_CHAR(TO_DATE(SYSDATE),'YYYY')) - TO_NUMBER(TO_CHAR(TO_DATE(BIRTH),'YYYY')) AS P_AGE
    FROM PROFESSORS
    WHERE PADDR = 'RG01'
    AND PGENDER = 'F'
    AND TO_NUMBER(TO_CHAR(TO_DATE(SYSDATE),'YYYY')) - TO_NUMBER(TO_CHAR(TO_DATE(BIRTH),'YYYY')) >= 40
    ;
    
    SELECT TO_NUMBER(TO_CHAR(TO_DATE(SYSDATE),'YYYY')) - TO_NUMBER(TO_CHAR(TO_DATE(BIRTH),'YYYY'))
    FROM PROFESSORS
    ;
    
  
  
        

CREATE TABLE SCORES
(
    SID         CHAR(4)             NOT NULL,
    PID         CHAR(4)             NOT NULL,
    SUBID       CHAR(4)             NOT NULL,
    EIDX        NUMBER(5)           NOT NULL,
    SCIDX       NUMBER(5)           NOT NULL,
    SCORE       NUMBER(5,2)         NOT NULL
);

    --김돌우
    INSERT INTO SCORES VALUES('S001', 'P001', 'S001', 1, 1, 91.12);
    INSERT INTO SCORES VALUES('S001', 'P002', 'S002', 1, 1, 78.67);                             
    INSERT INTO SCORES VALUES('S001', 'P003', 'S003', 1, 1, 86.45);
    INSERT INTO SCORES VALUES('S001', 'P004', 'S004', 1, 1, 80.67);
    INSERT INTO SCORES VALUES('S001', 'P005', 'S005', 1, 1, 90);
    INSERT INTO SCORES VALUES('S001', 'P006', 'S006', 1, 1, 77);
    
    --박영익
    INSERT INTO SCORES VALUES('S002', 'P001', 'S001', 1, 1, 69);
    INSERT INTO SCORES VALUES('S002', 'P002', 'S002', 1, 1, 98);                             
    INSERT INTO SCORES VALUES('S002', 'P003', 'S003', 1, 1, 56);
    INSERT INTO SCORES VALUES('S002', 'P004', 'S004', 1, 1, 78);
    INSERT INTO SCORES VALUES('S002', 'P005', 'S005', 1, 1, 87.90);
    INSERT INTO SCORES VALUES('S002', 'P006', 'S006', 1, 1, 76.20);
    
    --도소욱
    INSERT INTO SCORES VALUES('S003', 'P002', 'S002', 1, 1, 65.44);
    INSERT INTO SCORES VALUES('S003', 'P003', 'S003', 1, 1, 78.09);                             
    INSERT INTO SCORES VALUES('S003', 'P004', 'S004', 1, 1, 88);
    INSERT INTO SCORES VALUES('S003', 'P005', 'S005', 1, 1, 56);
    INSERT INTO SCORES VALUES('S003', 'P006', 'S006', 1, 1, 78);

    --정미주
    INSERT INTO SCORES VALUES('S004', 'P001', 'S001', 1, 1, 90);
    INSERT INTO SCORES VALUES('S004', 'P002', 'S002', 1, 1, 77);                             
    INSERT INTO SCORES VALUES('S004', 'P003', 'S003', 1, 1, 90);
    INSERT INTO SCORES VALUES('S004', 'P004', 'S004', 1, 1, 94);
    INSERT INTO SCORES VALUES('S004', 'P005', 'S005', 1, 1, 76.44);
    INSERT INTO SCORES VALUES('S004', 'P006', 'S006', 1, 1, 87.45);
    
    --김기윤
    INSERT INTO SCORES VALUES('S005', 'P001', 'S001', 1, 1, 77.45);
    INSERT INTO SCORES VALUES('S005', 'P002', 'S002', 1, 1, 99);                             
    INSERT INTO SCORES VALUES('S005', 'P003', 'S003', 1, 1, 87);
    INSERT INTO SCORES VALUES('S005', 'P004', 'S004', 1, 1, 78);
    

    --이효진
    INSERT INTO SCORES VALUES('S006', 'P001', 'S001', 1, 1, 77);
    INSERT INTO SCORES VALUES('S006', 'P002', 'S002', 1, 1, 65);                             
    INSERT INTO SCORES VALUES('S006', 'P003', 'S003', 1, 1, 54);
    INSERT INTO SCORES VALUES('S006', 'P004', 'S004', 1, 1, 77.44);
    INSERT INTO SCORES VALUES('S006', 'P005', 'S005', 1, 1, 80.87);
    INSERT INTO SCORES VALUES('S006', 'P006', 'S006', 1, 1, 98);
    
    
    --강신욱
    INSERT INTO SCORES VALUES('S008', 'P001', 'S001', 1, 1, 90);
    INSERT INTO SCORES VALUES('S008', 'P002', 'S002', 1, 1, 88.67);                             
    INSERT INTO SCORES VALUES('S008', 'P003', 'S003', 1, 1, 67.56);
    INSERT INTO SCORES VALUES('S008', 'P004', 'S004', 1, 1, 90);
    INSERT INTO SCORES VALUES('S008', 'P005', 'S005', 1, 1, 71.11);
    INSERT INTO SCORES VALUES('S008', 'P006', 'S006', 1, 1, 87.45);
    
    --박범식
    INSERT INTO SCORES VALUES('S009', 'P001', 'S001', 1, 1, 65);
    INSERT INTO SCORES VALUES('S009', 'P002', 'S002', 1, 1, 56.67);                             
    INSERT INTO SCORES VALUES('S009', 'P003', 'S003', 1, 1, 77);
    INSERT INTO SCORES VALUES('S009', 'P004', 'S004', 1, 1, 82);
    INSERT INTO SCORES VALUES('S009', 'P005', 'S005', 1, 1, 83.09);
    INSERT INTO SCORES VALUES('S009', 'P006', 'S006', 1, 1, 93);
    
    --여인순
    INSERT INTO SCORES VALUES('S007', 'P001', 'S001', 1, 1, 56);
    INSERT INTO SCORES VALUES('S007', 'P002', 'S002', 1, 1, 97);                             
    INSERT INTO SCORES VALUES('S007', 'P003', 'S003', 1, 1, 57);
    INSERT INTO SCORES VALUES('S007', 'P004', 'S004', 1, 1, 90);
    INSERT INTO SCORES VALUES('S007', 'P005', 'S005', 1, 1, 76);
    INSERT INTO SCORES VALUES('S007', 'P006', 'S006', 1, 1, 84);
    
    --최순애
    INSERT INTO SCORES VALUES('S010', 'P001', 'S001', 1, 1, 78);
    INSERT INTO SCORES VALUES('S010', 'P003', 'S002', 1, 1, 89);                             
    INSERT INTO SCORES VALUES('S010', 'P006', 'S004', 1, 1, 78.56);
    INSERT INTO SCORES VALUES('S010', 'P007', 'S005', 1, 1, 80.88);
    INSERT INTO SCORES VALUES('S010', 'P008', 'S006', 1, 1, 98);
    
    --COMMIT;
    
    --1. 각 교수별 시험출제 현황 리스트를 보여주세요
    --(교수이름, 과목명, 시험명)
    
    --2. 지역별 학생수 리스트를 보여주세요
    
    --3. 지역별 교수숫자 리스트를 보여주세요
    
    --4  국어시험 1을 국어시험으로 치른 학생 리스트를 보여주세요
    
    --5. 부산에 사는 학생들의 영어시험 평균과 총점을 리스트로 보여주세요
    SELECT * FROM STUDENTS;
    SELECT * FROM EXAMS;
    SELECT * FROM SCORES
    WHERE PID = 'P005' AND SUBID = 'S003'
    ;
    
    SELECT T1.SID, T1.SNAME, SUM(NVL(T2.SCORE, 0)) AS TLT, AVG(NVL(T2.SCORE, 0)) AS AVG
    FROM STUDENTS T1,
    (
        SELECT * FROM SCORES
        WHERE PID = 'P005' AND SUBID = 'S003'
    ) T2
    WHERE T1.SID = T2.SID(+)
    AND T1.SADDR = '부산'
    GROUP BY T1.SID, T1.SNAME
    ;
    
    --6. 남자 교수님들이 출제한 시험의 총점과 평균을 구해주세요
    SELECT * FROM PROFESSORS
    WHERE PGENDER = 'M'
    ;
    
    SELECT * FROM EXAMS;
    
    SELECT * FROM SCORES;
    
    SELECT T1.PGENDER, SUM(SCORE), AVG(SCORE)
    FROM PROFESSORS T1, EXAMS T2, SCORES T3
    WHERE T1.PID = T2.PID
    AND T2.PID = T3.PID AND T2.SUBID = T3.SUBID
    AND T1.PGENDER = 'M'
    GROUP BY T1.PGENDER
    ;
    
    --7. 각 학생별로 시험을 치룬 과목수를 리스트로 보여주세요
    
    --8. 1980년대생 교수들이 출제한 과목을 리스트로 보여주세요
    
    --9. 시험출제를 하지 않은 교수를 보여주세요
    
    --10. 여자교수님들이 출제한 시험의 총점과 평균을 구해주세요
    
    --11. 20대 여학생이 치른 시험의 총점과 평균을 구해주세요
    
    --12. 각 지역별로 학생들의 총점과 평균을 구해주세요
    
    --13. 각 과목(시험아님)별로 평균점수를 구해주세요
    
    --14. 모든학생들의 총점과 평균 점수를 보여주세요S
    
    --15. 각 교수별로 출제한 시험의 평균 점수를 보여주세요
    
    --16. 시험별로 시험을 치르지 않은 학생 리스트를 보여주세요
    
    --17. 평균점수가 가장 높은 시험의 가장높은 점수를 받은 학생을 찾아주세요
    SELECT * FROM EXAMS;
    SELECT * FROM SCORES;
    
    
    
    SELECT PID, SUBID, AVG(SCORE) AS MAXSCORE 
    FROM
    (
        SELECT A.SID, A.SNAME, B.SUBID, B.PID, NVL(B.SCORE,0) AS SCORE 
                
        FROM
        (
            SELECT T1.SID, T1.SNAME, T2.SUBID, T3.PID
            FROM STUDENTS T1,
            (
                SELECT SUBID FROM EXAMS
                GROUP BY SUBID
            ) T2, SCORES T3
            WHERE T2.SUBID = T3.SUBID AND T1.SID = T3.SID
        ) A,
        (
            SELECT T1.SID, T2.SUBID, T2.PID, MAX(T2.SCORE) AS SCORE 
            FROM STUDENTS T1, SCORES T2
            WHERE T1.SID = T2.SID
            GROUP BY T1.SID, T2.SUBID, T2.PID
        ) B
        WHERE A.SID = B.SID(+) AND A.SUBID = B.SUBID(+)
    )
    GROUP BY PID, SUBID
    ORDER BY  AVG(SCORE) DESC
    ;
    

    SELECT * 
    FROM EXAMS T1, SCORES T2
    WHERE T1.PID = T2.PID AND T1.SUBID = T2.SUBID
    ;
    
    SELECT * FROM SCORES
    WHERE PID = 'P003' AND SUBID = 'S002'
    ;
    
    
    /********************************************************************/
    SELECT SID, SNAME, ENAME, SCORE FROM
    (
        SELECT E.SID, E.SNAME, C.ENAME, D.SCORE, C.AVGSCORE, 
        RANK() OVER(ORDER BY SCORE DESC) AS RNK
        FROM
        (
            SELECT A.PID, A.SUBID, AVG(NVL(SCORE, 0)) AS AVGSCORE,
            (SELECT ENAME FROM EXAMS WHERE PID = A.PID AND SUBID = A.SUBID) AS ENAME,
            RANK() OVER (ORDER BY AVG(NVL(SCORE, 0)) DESC) AS RNK
            FROM
            (
                SELECT T1.SID, T1.SNAME, T2.SUBID, --T3.SUBID,
                NVL(T3.PID, (SELECT MAX(PID) FROM EXAMS WHERE SUBID = T2.SUBID)) AS PID
                FROM STUDENTS T1,
                (
                    SELECT SUBID FROM EXAMS
                    GROUP BY SUBID
                ) T2, SCORES T3
                WHERE T2.SUBID = T3.SUBID(+) AND T1.SID = T3.SID(+)
            ) A, SCORES B
            WHERE A.SID = B.SID(+) AND A.PID = B.PID(+) AND A.SUBID = B.SUBID(+)
            GROUP BY A.PID, A.SUBID
            ORDER BY AVG(NVL(SCORE, 0)) DESC
        ) C, SCORES D, STUDENTS E
        WHERE C.PID = D.PID AND C.SUBID = D.SUBID 
        AND D.SID = E.SID
        AND C.RNK = 1
    )
    WHERE RNK = 1
    ;
    
    
    
    
    --18. 평균점수가 가장 낮은 시험의 가장낮은 점수를 받은 학생을 찾아주세요
    
    --19. 60점미만이면 재시험이라고 하면 재시험을 쳐야 하는 시험과 학생수를 보여주세요
    
    --20. 가장 평균이 높은 시험을 출제한 교수가 사는 지역에 살고 있는 학생리스트를 보여주세요